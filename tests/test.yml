---
- hosts: test_machine
  become: yes

  vars:
    docker_volumes: /srv/docker

  roles:
    - role: install-docker
      storage_driver: overlay2
      cleanup_enabled: no
      install_pip_docker: yes

    - role: install-gitlab
      image_version: 12.9.2-ce.0
      config_volume: "{{docker_volumes}}/gitlab/config"
      data_volume: "{{docker_volumes}}/gitlab/data"
      log_volume: "{{docker_volumes}}/gitlab/log"
      backup_volume: "{{docker_volumes}}/gitlab/backups"
      external_url: http://192.168.33.72
      ssh_host: 192.168.33.72
      https_port: 443
      http_port: 80
      ssh_port: 10022
      shell_ssh_port: 10022
      email:
        enabled: true
        from: 'gitlab@git.myserver.org'
        display_name: 'gitlab@git.myserver.org'
        reply_to: 'gitlab@git.myserver.org'
        subject_suffix: '[Gitlab]'
      backup_keep_time: 604800


    - role: ansible-gitlab-runner
      image_version: alpine-v12.9.0
      gitlab_uri: http://192.168.33.72
      registration_token: X_xyNGwe3Knvxz657LoE
      config_volume: /srv/docker/gitlab-runner
